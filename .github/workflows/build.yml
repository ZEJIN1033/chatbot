name: CI/CD

on:
  push:
    branches:
      - '*'
  pull_request:
    branches:
      - '*'

jobs:
  # python-formatting:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3

  #     - name: Setup Python
  #       uses: actions/setup-python@v2
  #       with:
  #         python-version: 3.11

  #     - name: Install flake8
  #       run: pip install flake8

  #     - name: Run flake8
  #       run: flake8 api/

  # pytest-check:
  #   needs: python-formatting
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3

  #     - name: Use secret as environment variable
  #       run: echo "database_key=${{ secrets.DATABASE_KEY }}" >> $GITHUB_ENV
      
  #     - name: Check if environment variable is set
  #       run: |
  #         if [ -z "$database_key" ]; then
  #           echo "database_key is not set"
  #         else
  #           echo "database_key is set"
  #         fi

  #     - name: Setup Python
  #       uses: actions/setup-python@v2
  #       with:
  #         python-version: 3.11

  #     - name: Install requirements
  #       run: pip install -r requirements.txt

  #     - name: Run Pytest
  #       run: pytest api/test_app.py

  deploy-to-vercel:
    # needs: pytest-check
    runs-on: ubuntu-latest
    if: github.event_name == 'push' || (github.event_name == 'pull_request' && github.ref == 'refs/pull/*/merge')
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'